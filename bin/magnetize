#!/usr/bin/env ruby

require 'gli'
require 'dotenv'
require 'io/console'

require 'magnetize'

include GLI::App

program_desc 'CLI for generating Magento local.xml files.'

version Magnetize::VERSION

desc 'Generate Magneto local.xml files'
command :configure do |c|
  c.desc "Environment to configure."
  c.flag :environment, default_value: 'local'

  c.desc "Magento application directory."
  c.flag :application, default_value: './'
  
  c.desc 'Force overwrite of existing config.'
  c.switch [:force]

  c.action do |global_options, options, args|
    Dotenv.load ".env.#{options['environment']}", '.env'
    @magento.save(options['application'], options['force'])
  end
end

pre do |global, command, options, args|
  @magento = Magnetize::Magento.new

  true
end

post do |global, command, options, args|

end

on_error do |exception|
  true
end

exit run(ARGV)
